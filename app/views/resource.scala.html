@* resource Template File *@
@(js: String)

@import play.api.libs.json._
@import com.fasterxml.jackson.databind.JsonNode


@analyseValue(v: String)={
@v match {
case a if v.startsWith("http") => {
<a href=@v>@v</a>
}
case a if v.startsWith("edoweb") => {
<a href=/resource/@v>@v</a>
}
case _ => {@v
}
}
}

@value(value: JsValue)= {
@value match {
case a: JsString => {
@analyseValue(value.as[String])
}
case b: JsObject => {
@((value \ "prefLabel").asOpt[String].getOrElse(value.asOpt[String])) |
<a title="Linked-Data-Quelle abrufen" href=@((value \ "@id").asOpt[String].getOrElse(value.asOpt[String]))><span class="glyphicon glyphicon-link"></span></a>
}
}
<br/>
}


@htmlRow(values: JsValue,label: String,hit: JsValue)={
	@values match {
		case a: JsString => { 
			<tr>
				<td>@label</td>
				<td>
					@value(values)
				</td>
			</tr>
  	}
		case b: JsArray => {	
			<tr>
				<td>@label</td>
				<td>
			@for(field <- values.asOpt[Seq[JsValue]].getOrElse(Seq())){	
				@value(field)	
			} 
				</td>
			</tr>	
		}	
		case c : JsObject => {
			<tr>
				<td>@label</td>
				<td>
					<table class="table table-striped table-condensed">
					@for((k,v) <- values.as[JsObject].value){
						@htmlRow(v,(hit \ "@context" \ k \ "label").asOpt[String].getOrElse(k),hit)
					}
					</table>
				</td>
			</tr>	
		}
		case _ => {}
	}	
}


@tableRow(label: JsValue,name: String,hit:JsValue ) = {
@htmlRow((hit \ name),label.asOpt[String].getOrElse(name),hit)
}
@table(hit: JsValue)={
<table class="table table-striped table-condensed">
@for(k <- (hit \ "@context").as[JsObject].keys.toSeq.sorted){
		@tableRow((hit \ "@context" \ k \ "label"),k,hit)
	}	
	</table>
}
@main("") {
@defining(Json.parse(js).asOpt[Seq[JsValue]].getOrElse(Seq())) { hits =>
@for( hit <- hits){
<h1><a href=/resource/@((hit \ "@id").asOpt[String].getOrElse(""))>@((hit \ "title").asOpt[Seq[String]].getOrElse("No title"))</a></h1>
@table(hit)

}
}

}