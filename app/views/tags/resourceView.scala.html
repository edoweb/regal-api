@* Copyright 2014 Jan Schnasse, hbz. Licensed under the Apache License 2.0 *@

@(hit: play.api.libs.json.JsValue)
@import play.api.libs.json._
@import com.fasterxml.jackson.databind.JsonNode



<table class="table table-striped table-condensed">
@for(k <- (hit \ "@context").as[JsObject].keys.toSeq.sorted){
		@tableRow((hit \ "@context" \ k \ "label"),k,hit)
	}	
	</table>




@analyseValue(v: String)={
	@v match {
		case a if v.startsWith("http") => {
			<a href=@v>@v</a>
		}
		case a if v.startsWith("edoweb") => {
			<a href=/resource/@v>@v</a>
		}
		case _ => {
			@v
		}
	}
}

@value(value: JsValue)= {
	@value match {
		case a: JsString => {
			@analyseValue(value.as[String])
		}
		case b: JsObject => {
			<a href=http://api.localhost/find?q="@((value \ "@id").asOpt[String].getOrElse(value.asOpt[String]))">
			@((value \ "prefLabel").asOpt[String].getOrElse(value.asOpt[String]))
			</a> |
			<a title="Linked-Data-Quelle abrufen" href=@((value \ "@id").asOpt[String].getOrElse(value.asOpt[String]))><span class="glyphicon glyphicon-link"></span></a>
		}
	}
	<br/>
}


@htmlRow(values: JsValue,label: String, fieldId: String,hit: JsValue)={
	@values match {
		case a: JsString => { 
			<tr>
				<td><a href=@fieldId>@label</a></td>
				<td>
					@value(values)
				</td>
			</tr>
  		}
		case b: JsArray => {	
			<tr>
				<td><a href=@fieldId>@label</a></td>
				<td>
			@for(field <- values.asOpt[Seq[JsValue]].getOrElse(Seq())){	
				@value(field)	
			} 
				</td>
			</tr>	
		}	
		case c : JsObject => {
			<tr>
				<td><a href=@fieldId>@label</a></td>
				<td>
					<table class="table table-striped table-condensed">
					@for((k,v) <- values.as[JsObject].value){
						@htmlRow(v,(hit \ "@context" \ k \ "label").asOpt[String].getOrElse(k),fieldId,hit)
					}
					</table>
				</td>
			</tr>	
		}
		case _ => {}
	}	
}

@tableRow(label: JsValue,name: String,hit:JsValue ) = {
@htmlRow((hit \ name),label.asOpt[String].getOrElse(name),(hit \ "@context" \ name \ "@id").asOpt[String].getOrElse(""),hit)
}

