@* Copyright 2014 Jan Schnasse, hbz. Licensed under the Apache License 2.0 *@

@(hit: Map[String,Object],context:Map[String,Object],namespace:String)

<table class="table table-striped table-condensed" id="example" class="display" cellspacing="0" width="100%">
<thead><tr><th>Name</th><th>Value</th></tr></thead>
	@context match{
		case map : Map[String,Object] => {
			@for(k<-map.keys){
				@tableRow(k,hit)
			}
		}
		case _ => {}
	}
</table>

@htmlRow(values: Any,key: String)={
	@values match {
		case a: String => {
			<tr>
				<td><a href=@getFieldId(key)>@getLabel(key)</a></td>
				<td>
					@value(a,key)
				</td>
			</tr>
  		}
		case b: Set[Any] => {
			<tr>
				<td><a href=@getFieldId(key)>@getLabel(key)</a></td>
				<td>
					@for(field <- b){
						@value(field,key)
					}
				</td>
			</tr>
		}
		case d: List[Any] => {
			<tr>
				<td><a href=@getFieldId(key)>@getLabel(key)</a></td>
				<td>
					@for(field <- d){
						@value(field,key)
					}
				</td>
			</tr>
		}
		case c : Map[String,Object] => {
			<tr>
				<td><a href=@getFieldId(key)>@getLabel(key)</a></td>
				<td>
					<table class="table table-striped table-condensed">
					 @for((k,v)<-c){
					  @htmlRow(v,k.asInstanceOf[String])
					  }
					</table>
				</td>
			</tr>
		}
		case _ => { }
	}
}


@analyseString(v: String)={
	@v match {
		case a if v.startsWith("http") => {
			<a href=@v>@v</a>
		}
		case a if v.startsWith(namespace) => {
			<a href=/resource/@v>@v</a>
		}
		case _ => {
			@v
		}
	}
}

@analyseValue(v: String)={
	@v match {
		case a if v.startsWith("http") => {
			@v
		}
		case a if v.startsWith(namespace) => {
			/resource/@v
		}
		case _ => {
			@v
		}
	}
}

@value(value: Any,key:String)= {
	@value match {
		case a: String => {
			@analyseString(value.asInstanceOf[String])
		}
		case c : Map[String,Object] => {
					@displayMap(c.get("id"),c)
		}
		case _ => {
		
		}
	}
	<br/>
}

@displayMap(value:Any,map:Map[String,Object])={
	@value match {
		case a: String => {
		 <span class="@models.Globals.profile.getEtikett(a).getIcon()"></span>
                       <a href=@analyseValue(a)>
                       @(map.get("label"))
                       </a> |
                       <a title="Ã„hnliche Objekte suchen" href=/find?q="@helper.urlEncode(a)">
                               <span class="glyphicon glyphicon-link"></span>
                       </a>
		
		}
		case _ => {		
			<table class="table table-striped table-condensed">
			@htmlRow(map,"")
			</table>
		}
		}
}

@getLabel(key: String)={
		@context match{
			case map : Map[String,Object] => {
				@map.get(key) match { 
					case keyMap : Map[String,Object]=> {
						@keyMap.get("label") match {
						 case label: String =>{
						 	@label
						 }
						 case _ => {@key}
						}
					}
					case _ => {@key}
				}
			}
			case _ => {@key}
	}
}

@getFieldId(key: String)={
		@context match{
			case map : Map[String,Object] => {
				@map.get(key) match { 
					case keyMap : Map[String,Object]=> {
						@keyMap.get("@id")
					}
					case _ => {@key}
					
				}
			}
			case _ => {@key}
		}
}
@tableRow(key: String,hit:Map[String,Object]) = {
@htmlRow(hit.get(key), key)
}