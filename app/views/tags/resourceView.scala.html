@* Copyright 2014 Jan Schnasse, hbz. Licensed under the Apache License 2.0 *@

@(hit: Map[String,Object],context:Map[String,Object])

<table class="table table-striped table-condensed">
	@context match{
		case map : Map[String,Object] => {
			@for(k<-map.keys){
				@tableRow(k,hit)
			}
		}
		case _ => {}
	}
</table>

@htmlRow(values: Any,key: String)={
	@values match {
		case a: String => {
			<tr>
				<td><a href=@getFieldId(key)>@getLabel(key)</a></td>
				<td>
					@value(a)
				</td>
			</tr>
  		}
		case b: List[Any] => {
			<tr>
				<td><a href=@getFieldId(key)>@getLabel(key)</a></td>
				<td>
					@for(field <- b){
						@value(field)
					}
				</td>
			</tr>
		}
		case c : Map[String,Object] => {
			<tr>
				<td><a href=@getFieldId(key)>@getLabel(key)</a></td>
				<td>
					<table class="table table-striped table-condensed">
					 @for((k,v)<-c){
					  @htmlRow(v,k.asInstanceOf[String])
					  }
					</table>
				</td>
			</tr>
		}
		
		case _ => {}
	}
}
@analyseString(v: String)={
	@v match {
		case a if v.startsWith("http") => {
			<a href=@v>@v</a>
		}
		case a if v.startsWith("edoweb") => {
			<a href=/resource/@v>@v</a>
		}
		case _ => {
			@v
		}
	}
}

@analyseValue(v: String)={
	@v match {
		case a if v.startsWith("http") => {
			@v
		}
		case a if v.startsWith("edoweb") => {
			/resource/@v
		}
		case _ => {
			@v
		}
	}
}

@value(value: Any)= {
	@value match {
		case a: String => {
			@analyseString(value.asInstanceOf[String])
		}
		case b: Map[String,Object] => {
			<span class="@models.Globals.profile.getIcon(b.get("@id").asInstanceOf[String])"></span>
			<a href=@analyseValue(b.get("@id").asInstanceOf[String])>
			@(b.get("prefLabel"))
			</a> |
			<a title="Ã„hnliche Objekte suchen" href=/find?q="@helper.urlEncode(b.get("@id").asInstanceOf[String])">
				<span class="glyphicon glyphicon-link"></span>
			</a>
		}
	}
	<br/>
}

@getLabel(key: String)={
		@context match{
			case map : Map[String,Object] => {
				@map.get(key) match { 
					case keyMap : Map[String,Object]=> {
						@keyMap.get("label") match {
						 case label: String =>{
						 	@label
						 }
						 case _ => {@key}
						}
					}
					case _ => {@key}
				}
			}
			case _ => {@key}
	}
}

@getFieldId(key: String)={
		@context match{
			case map : Map[String,Object] => {
				@map.get(key) match { 
					case keyMap : Map[String,Object]=> {
						@keyMap.get("@id")
					}
					case _ => {@key}
					
				}
			}
			case _ => {@key}
		}
}
@tableRow(key: String,hit:Map[String,Object]) = {
@htmlRow(hit.get(key), key)
}