
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="de">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Neues Metadaten-Format in die OAI-Schnittstelle integrieren &#8212; regal-api  Dokumentation</title>
    <link rel="stylesheet" href="../_static/hbz.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/translations.js"></script>
    <link rel="index" title="Stichwortverzeichnis" href="../genindex.html" />
    <link rel="search" title="Suche" href="../search.html" />
    <link rel="prev" title="Willkommen zur regal-api Dokumentation!" href="../index.html" />
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Neuton&amp;subset=latin" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Nobile:regular,italic,bold,bolditalic&amp;subset=latin" type="text/css" media="screen" charset="utf-8" />
<!--[if lte IE 6]>
<link rel="stylesheet" href="../_static/ie6.css" type="text/css" media="screen" charset="utf-8" />
<![endif]-->

  </head><body>
<div class="header" role="banner">
  <div class="logo">
    <svg xmlns="http://www.w3.org/2000/svg" width="185" height="65">
       <path d="M185.191 54.057v-7.596h-5.649c-2.402 0-5.973 0-7.336.065l12.726-18.829V21.79h-22.596v7.401h5.713c3.117 0 5.65-.064 6.883-.13L161.946 48.15v5.908h23.245M94.26 13.024v41.033h8.31V38.475c0-5.649 3.247-10.453 7.467-10.453 3.116 0 4.025 2.013 4.025 5.389v20.646h8.247V31.398c0-5.649-2.337-10.323-9.61-10.323-5.065 0-8.766 2.402-10.648 6.038l-.065-.065c.454-1.883.585-4.61.585-6.558V6.596c-4.805-.13-9.806.065-13.96.585v5.193c1.882.13 4.09.39 5.648.65" fill="#f18123"></path><path d="M137.622 6.503c-4.805-.13-9.804.065-13.96.584v5.194c1.883.13 4.09.39 5.65.65v40.125c3.7 1.039 7.336 1.558 12.011 1.558 11.103 0 17.466-7.532 17.466-18.44 0-9.544-4.155-15.128-11.882-15.128-4.545 0-8.116 2.208-9.74 5.714h-.064c.324-1.688.519-4.35.519-6.298V6.503zm12.402 30.515c0 7.987-3.377 10.973-8.117 10.973-1.753 0-3.116-.194-4.285-.584v-9.09c0-5.389 2.597-10.388 6.882-10.388 3.766 0 5.52 3.051 5.52 9.09" fill="#f18123" fill-rule="evenodd"></path><path d="M50.832 42.772V11.641H13.903V5.625l49.105-.001.003 37.148H50.83" fill="#004678"></path><path d="M21.654 44.5h43.084V5.636l7.428.001-.001 48.399h-50.51V44.5" fill="#004678"></path><path d="M19.928 13.368v42.395h43.083l-.002 9.763H13.903V13.368h6.025" fill="#004678"></path><path d="M63.008 3.897H12.177v50.139H0V.002L63.008 0v3.897" fill="#004678"></path>
    </svg>
  </div>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="Stichwortverzeichnis"
             accesskey="I">Index</a></li>
        <li class="right" >
          <a href="../index.html" title="Willkommen zur regal-api Dokumentation!"
             accesskey="P">zurück</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">regal-api  Dokumentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="neues-metadaten-format-in-die-oai-schnittstelle-integrieren">
<h1>Neues Metadaten-Format in die OAI-Schnittstelle integrieren<a class="headerlink" href="#neues-metadaten-format-in-die-oai-schnittstelle-integrieren" title="Link zu dieser Überschrift">¶</a></h1>
<p>Die Integration eines neuen Metadatenformats in die OAI-Schnittstelle umfasst zurzeit noch Aktivitäten an mehreren Stellen.</p>
<ol class="arabic simple">
<li>Java-Klassen erweitern und anpassen</li>
<li>Konfiguration der regal-api und des OAI-Providers anpassen</li>
<li>Testen der Schnittstelle</li>
</ol>
<div class="section" id="java-klassen-erweitern-und-anpassen">
<h2>Java-Klassen erweitern und anpassen<a class="headerlink" href="#java-klassen-erweitern-und-anpassen" title="Link zu dieser Überschrift">¶</a></h2>
<p>Für die Integration eines neuen Metadaten-Formats in die OAI-Schnittstelle sind die folgenden Dateien relevant.</p>
<ul class="simple">
<li>regal-api.app.helper.oai/OaiDispatcher.java</li>
<li>regal-api.app.actions/Transform.java</li>
<li>regal-api.app.controllers/Resource.java</li>
</ul>
<p>In disen drei Klassen müssen an mehreren Stellen Anpassungen, bzw. Erweiterungen des Codes vorgenommen werden, damit das Mapping und die Erstellung
eines Metadaten-Stroms im System ausgelöst und gesteuert wird.</p>
<p>In der Datei OaiDispatcher.java muss ein zusätzlicher Transformer-Aufruf generiert werden und eine neue Methode addNeuesFormatTransformer erstellt werden.</p>
<div class="code java highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">private</span> <span class="n">static</span> <span class="n">void</span> <span class="n">addNeuesFormatTransformer</span><span class="p">(</span><span class="n">Node</span> <span class="n">node</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">String</span> <span class="nb">type</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">getContentType</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;public&quot;</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">getPublishScheme</span><span class="p">()))</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;monograph&quot;</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="nb">type</span><span class="p">)</span> <span class="o">||</span> <span class="s2">&quot;journal&quot;</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="nb">type</span><span class="p">)</span>
        <span class="o">||</span> <span class="s2">&quot;webpage&quot;</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="nb">type</span><span class="p">)</span> <span class="o">||</span> <span class="s2">&quot;researchData&quot;</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="nb">type</span><span class="p">)</span>
        <span class="o">||</span> <span class="s2">&quot;article&quot;</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="nb">type</span><span class="p">))</span> <span class="p">{</span>
          <span class="n">node</span><span class="o">.</span><span class="n">addTransformer</span><span class="p">(</span><span class="n">new</span> <span class="n">Transformer</span><span class="p">(</span><span class="s2">&quot;neuesFormat&quot;</span><span class="p">));</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
</pre></div>
</div>
<p>Ebenso muss in die Methode addUnknownTransformer eine zusätzliche If-Abfrage integriert werden.</p>
<div class="code java highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">private</span> <span class="n">static</span> <span class="n">void</span> <span class="n">addUnknownTransformer</span><span class="p">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">transformers</span><span class="p">,</span>
  <span class="n">Node</span> <span class="n">node</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">transformers</span> <span class="o">!=</span> <span class="n">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">String</span> <span class="n">t</span> <span class="p">:</span> <span class="n">transformers</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;oaidc&quot;</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
        <span class="k">continue</span><span class="p">;</span> <span class="o">//</span> <span class="n">implicitly</span> <span class="n">added</span> <span class="o">-</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">allowed</span> <span class="n">to</span> <span class="nb">set</span>
  <span class="p">[</span><span class="o">...</span><span class="p">]</span>
      <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;neuesFormat&quot;</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
        <span class="k">continue</span><span class="p">;</span> <span class="o">//</span> <span class="n">implicitly</span> <span class="n">added</span> <span class="o">-</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">allowed</span> <span class="n">to</span> <span class="nb">set</span>
      <span class="n">node</span><span class="o">.</span><span class="n">addTransformer</span><span class="p">(</span><span class="n">new</span> <span class="n">Transformer</span><span class="p">(</span><span class="n">t</span><span class="p">));</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Die Datei Transform muss um eine Methode neuesFormat erweitert werden. Diese Methode wird später über eine, in der Datei Resource.java definierte
ApiOperation „asNeuesFormat“ als Restful-Request aufgerufen. Die ApiOperation muss entsprechend auch angelegt werden.</p>
<p>Das Mappen und die Erzeugung eines Metadatenstroms wurde in der Vergangenheit über unterschiedliche Wege umgesetzt, bei denen ebenfalls mehrere Klassen und ggf.
ScalaViews beteiligt sind.</p>
<p>Im Package helper.oai wird ein neuer Mapper angelegt, über den die im lobid V2-Format zur Verfügung gestellten Metadaten in das neue Format gemappt werden.
Bisher kamen dafür die Klassen ObjectMapper aus der Jackson Library, models.Pair und entweder ein Datenmodell plus Mapper oder eine Record Klasse zum Einsatz.</p>
<p>Innerhalb des Packages view.oai mussten bei der Nutzung eines Datenmodells und eines Mappers zusätzlich die Klassen NeuesFormat.scala.html und
NeuesFormatView.scala.html angelegt werden.Diese steuern das Parsing und die Darstellung des neuen Formats über die Scala-Infrastruktur.
Im Unterschied dazu erzeugen die Record-Klassen String-Representationen eines XML-Datenstroms.</p>
<p>Zur Vereinfachung und Vereinheitlichung wurde für kommende Metadatenformate eine neue Klase angelegt, mit der variable JSON-Datenströme in vergleichsweise
einheitlich nutzbare Java-Strukturen übersetzt werden.</p>
</div>
<div class="section" id="konfiguration-der-regal-api-und-des-oai-providers-anpassen">
<h2>Konfiguration der regal-api und des OAI-Providers anpassen<a class="headerlink" href="#konfiguration-der-regal-api-und-des-oai-providers-anpassen" title="Link zu dieser Überschrift">¶</a></h2>
<p>Damit das als Dissemination* angelegte neue Format über die regal-api abgefragt werden kann, muss in der Datei conf/routes eine entsprechende Konfigurationszeile erstellt werden.</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span>GET /resource/:pid.openaire     controllers.Resource.asOpenAire(pid, validate : Boolean ?= false)
</pre></div>
</div>
<p>Mit dieseem Eintrag wird eine Verbindung zwischen der entsprechenden Java-Methode und dem über das Play Framework stattfindenden Aufruf über eine HTTP-Methode erreicht.</p>
<p>Wie zu sehen ist, wird hier auch bestimmt, ob das erstellte Objekt normalerweise gegen eine xsd-Datei validiert werden soll. Im Beispile ist das nicht der Fall: validate : Boolean ?= false.
In der Datei proai.properties müssen die mit der OAI-Schnittstelle zusammenhängenden Konfigurationen angepasst werden. Die Datei wird direkt im entpackten Applikation-Container angepasst.</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">################################################</span>
<span class="c1"># Fedora Driver: Metadata Format Configuration #</span>
<span class="c1">################################################</span>
<span class="c1"># Metadata formats to make available.</span>
<span class="n">driver</span><span class="o">.</span><span class="n">fedora</span><span class="o">.</span><span class="n">md</span><span class="o">.</span><span class="n">formats</span> <span class="o">=</span> <span class="n">oai_dc</span> <span class="n">epicur</span> <span class="n">mabxml</span><span class="o">-</span><span class="mi">1</span> <span class="n">mets</span> <span class="n">rdf</span> <span class="n">oai_wgl</span> <span class="n">oai_openaire</span>
<span class="p">[</span><span class="o">...</span><span class="p">]</span>
<span class="n">driver</span><span class="o">.</span><span class="n">fedora</span><span class="o">.</span><span class="n">md</span><span class="o">.</span><span class="n">format</span><span class="o">.</span><span class="n">oai_ore</span><span class="o">.</span><span class="n">loc</span> <span class="o">=</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">w3</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="mi">2000</span><span class="o">/</span><span class="mi">07</span><span class="o">/</span><span class="n">rdf</span><span class="o">.</span><span class="n">xsd</span>

<span class="n">driver</span><span class="o">.</span><span class="n">fedora</span><span class="o">.</span><span class="n">md</span><span class="o">.</span><span class="n">format</span><span class="o">.</span><span class="n">oai_openaire</span><span class="o">.</span><span class="n">loc</span> <span class="o">=</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">openaire</span><span class="o">.</span><span class="n">eu</span><span class="o">/</span><span class="n">schema</span><span class="o">/</span><span class="n">repo</span><span class="o">-</span><span class="n">lit</span><span class="o">/</span><span class="mf">4.0</span><span class="o">/</span><span class="n">openaire</span><span class="o">.</span><span class="n">xsd</span>

<span class="p">[</span><span class="o">...</span><span class="p">]</span>

<span class="n">driver</span><span class="o">.</span><span class="n">fedora</span><span class="o">.</span><span class="n">md</span><span class="o">.</span><span class="n">format</span><span class="o">.</span><span class="n">oai_ore</span><span class="o">.</span><span class="n">uri</span> <span class="o">=</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">w3</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="mi">1999</span><span class="o">/</span><span class="mi">02</span><span class="o">/</span><span class="mi">22</span><span class="o">-</span><span class="n">rdf</span><span class="o">-</span><span class="n">syntax</span><span class="o">-</span><span class="n">ns</span><span class="c1">#</span>

<span class="n">driver</span><span class="o">.</span><span class="n">fedora</span><span class="o">.</span><span class="n">md</span><span class="o">.</span><span class="n">format</span><span class="o">.</span><span class="n">oai_openaire</span><span class="o">.</span><span class="n">uri</span> <span class="o">=</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">namespace</span><span class="o">.</span><span class="n">openaire</span><span class="o">.</span><span class="n">eu</span><span class="o">/</span><span class="n">schema</span><span class="o">/</span><span class="n">oaire</span><span class="o">/</span>

<span class="p">[</span><span class="o">...</span><span class="p">]</span>

<span class="n">driver</span><span class="o">.</span><span class="n">fedora</span><span class="o">.</span><span class="n">md</span><span class="o">.</span><span class="n">format</span><span class="o">.</span><span class="n">oai_dc</span><span class="o">.</span><span class="n">dissType</span> <span class="o">=</span> <span class="n">info</span><span class="p">:</span><span class="n">fedora</span><span class="o">/*/</span><span class="n">CM</span><span class="p">:</span><span class="n">oaidcServiceDefinition</span><span class="o">/</span><span class="n">oaidc</span>

<span class="n">driver</span><span class="o">.</span><span class="n">fedora</span><span class="o">.</span><span class="n">md</span><span class="o">.</span><span class="n">format</span><span class="o">.</span><span class="n">oai_openaire</span><span class="o">.</span><span class="n">dissType</span> <span class="o">=</span> <span class="n">info</span><span class="p">:</span><span class="n">fedora</span><span class="o">/*/</span><span class="n">CM</span><span class="p">:</span><span class="n">openaireServiceDefinition</span><span class="o">/</span><span class="n">openaire</span>
</pre></div>
</div>
</div>
<div class="section" id="testen-der-schnittstelle">
<h2>Testen der Schnittstelle<a class="headerlink" href="#testen-der-schnittstelle" title="Link zu dieser Überschrift">¶</a></h2>
<p>Die OAI-Schnittstelle ist über die URL <a class="reference external" href="http://api.ellinet-dev.hbz-nrw.de/oai-pmh/">http://api.ellinet-dev.hbz-nrw.de/oai-pmh/</a> oder analog bei edoweb-test erreichbar.
Der neue ServiceDisseminator kann über die regal-api aufgerufen werden, wenn der in der routes Datei deklarierte Pfad entsprechend aufgerufen wird.
Obwohl GET als Methode deklariert ist, funktioniert jedoch nur der Aufruf mittels POST. Deshalb kommt cUrl zum Einsatz: curl -XGET -uedoweb-admin localhost:9000/resource/frl%3A6402576.openaire</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Inhalt</a></h3>
  <ul>
<li><a class="reference internal" href="#">Neues Metadaten-Format in die OAI-Schnittstelle integrieren</a><ul>
<li><a class="reference internal" href="#java-klassen-erweitern-und-anpassen">Java-Klassen erweitern und anpassen</a></li>
<li><a class="reference internal" href="#konfiguration-der-regal-api-und-des-oai-providers-anpassen">Konfiguration der regal-api und des OAI-Providers anpassen</a></li>
<li><a class="reference internal" href="#testen-der-schnittstelle">Testen der Schnittstelle</a></li>
</ul>
</li>
</ul>

  <h4>Vorheriges Thema</h4>
  <p class="topless"><a href="../index.html"
                        title="vorheriges Kapitel">Willkommen zur regal-api Dokumentation!</a></p>
  <div role="note" aria-label="source link">
    <h3>Diese Seite</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/developer-docs/oaiMetadataFormats.rst.txt"
            rel="nofollow">Quellcode anzeigen</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Schnellsuche</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Los" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="Stichwortverzeichnis"
             >Index</a></li>
        <li class="right" >
          <a href="../index.html" title="Willkommen zur regal-api Dokumentation!"
             >zurück</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">regal-api  Dokumentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2019, Andres Quast.
      Mit <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.6 erstellt.
    </div>
  </body>
</html>